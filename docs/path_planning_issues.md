# 路径规划问题记录

## 1. 当前遇到的主要问题

### 1.1 路径规划性能问题
- A*算法在大地图上（约3000x3000像素）搜索路径时经常达到最大迭代次数（100000次）
- 即使返回次优路径，路径质量也不理想
- 在某些情况下，算法完全无法找到可行路径

### 1.2 成本图生成问题
- 在`map_generator.py`中生成成本图时出现除零警告：
```python
RuntimeWarning: divide by zero encountered in divide
1.0 / speed_map,  # 成本为单位距离所需时间
```
- 这表明速度图中存在速度为0的区域，导致成本图中出现无穷大值

### 1.3 可达性判断问题
- 使用成本阈值（99百分位数）来判断点的可达性可能过于严格
- 一些实际可达的点被错误地判定为不可达
- 成本阈值的选择缺乏理论支持

## 2. 已尝试的解决方案

### 2.1 A*算法优化
1. 增加最大迭代次数（从50000到100000）
2. 使用向量化操作优化邻居节点的获取
3. 改进启发式函数（尝试切比雪夫距离和曼哈顿距离的组合）
4. 添加早期终止条件（路径长度超过直线距离2倍时返回次优解）
5. 使用成本阈值进行剪枝

### 2.2 成本计算优化
1. 预计算成本阈值，使用99百分位数
2. 设置最大成本为阈值的2倍
3. 在获取邻居时添加额外的成本检查

## 3. 建议的解决方向

### 3.1 算法层面
1. 考虑使用分层路径规划：
   - 第一层：在低分辨率地图上规划大致路径
   - 第二层：在高分辨率地图上细化路径
2. 实现双向A*搜索，从起点和终点同时开始搜索
3. 使用跳点搜索（Jump Point Search）优化A*算法
4. 考虑实现D*或D* Lite算法，它们在大规模地图上表现更好

### 3.2 数据处理层面
1. 重新设计成本图生成方法：
   - 处理速度为0的特殊情况
   - 使用对数尺度表示成本
   - 设计更合理的成本函数
2. 对地图进行预处理：
   - 识别并标记不可通行区域
   - 生成可通行区域的连通分量图
   - 预计算关键路径点

### 3.3 工程实现层面
1. 添加详细的日志记录：
   - 记录搜索过程中的关键决策
   - 统计算法性能指标
   - 可视化搜索过程
2. 实现渐进式优化：
   - 先返回一个快速但次优的解
   - 在时间允许的情况下继续优化
3. 添加缓存机制：
   - 缓存常用路径
   - 存储部分搜索结果

## 4. 下一步建议

1. 首先解决成本图生成中的除零问题
2. 实现分层路径规划策略
3. 添加详细的日志和可视化工具
4. 建立基准测试集，用于评估不同优化方案的效果
5. 考虑使用其他路径规划算法库（如OMPL）作为参考或替代方案

## 5. 需要收集的数据

1. 统计当前地图的基本特征：
   - 不同地形类型的分布
   - 速度分布情况
   - 成本分布情况
2. 记录失败案例的特征：
   - 起终点的位置特征
   - 路径长度和复杂度
   - 失败原因分类
3. 性能数据：
   - 不同距离下的搜索时间
   - 内存使用情况
   - 迭代次数分布 